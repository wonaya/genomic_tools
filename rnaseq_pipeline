# pipeline

## convert sra to fastq
module load sratoolkit
fastq-dump abc.sra
## quality check
fastqc abc.fastq
## trimmer (5bp on 5' 10bp on 3')
seqtk trimfq -b -e 10 abc.fq > abc_trim.fq
## genome index
module load bowtie/2.0.2
bowtie-build genome.fasta genome
## tophat align guided
module load tophat
tophat -o guided -G xxx.gtf --no-novel-juncs genome (index) abc_trim.fq
## tophat align unguided
tophat -o unguided abc_trim.fq
#### example : tophat -o=tophat_output/ bowtie_output/genome reads.fastq
## bwa align
module load bwa
bwa aln genome.fasta read1.fastq > read1.sai
bwa aln genome.fasta read2.fastq > read2.sai
bwa sampe genome.fasta read1.sai read2.sai read1.fastq read2.fastq > read.sam
## convert bam to sam
module load samtools
samtools view -h -o out.sam in.bam
## convert sam to bam
samtools view -bS in.sam > out.bam
## sort bamfile
samtools sort in.bam out.sorted
## merge bamfile
samtools merge out.bam in1.bam in2.bam
## igvtools tdf
module load jdk64
module load igvtools
/opt/apps/igvtools/2.1.7.igvtoos count out.sorted.bam out.sorted.tdf B73 (for maize)
## bam to bed
module load bedtools
bamToBed -i out.sorted.bam > out.sorted.bed
## gff to bed
sortBed -i myfile.gff | gff2bed > my_sorted_file.bed
## coverage from bedtools
genomeCoverageBed -ibam out.sorted.bam -g $WORK/maize_refgen_v2.txt
#### refgen info taken from http://genomevolution.org/CoGe/OrganismView.pl?dsgid=9106
coverageBed -a reads.bed -b exons.bed > exons.bed.coverage 
## reference genome fix in biopython
>>> from Bio import SeqIO
>>> SeqIO.convert("ZMgenome.fasta", "fasta", "ZMgenome_norm.fasta", "fasta")
## making bedgrah
genomeCoverageBed -bg -ibam sample.sorted.bam -g chromsizes.txt > sample.pos.bedgraph
## cufflinks : Assembly of RNA-seq reads into transcripts and report of the RPKM/FPKM using Cufflinks
module load cufflinks/2.0.2
cufflinks -o cufflink_out -G /work/02114/wonaya/genome/annotation/ZmB73_5a_WGS.gff LID114634_2_CAGATC_L002_pe_sorted.bam
####cufflinks -o=cufflinks_output/ --reference-seq=genome.fa tophat_output/accepted_hits.bam
## cuffcompare : Comparison of assembled transcripts with a reference annotation, or across experiments, using Cuffcompare
cuffcompare -o=cuffcompare_output -r=genome.gtf -R cufflinks_output/transcripts.gtf
5. Finding significant changes in transcript expression, splicing, and promoter use using Cuffdiff
cuffdiff -o cuffdiff_123 cufflink_bwa1/transcripts.gtf LID114634_1_GCCAAT_L002_pe_sorted.bam LID114634_2_CAGATC_L002_pe_sorted.bam LID114634_3_CTTGTA_L002_pe_sorted.bam
cuffdiff -o=cuffdiff_output/ cufflinks_output/transcripts.gff tophat_output/accepted_hits1a.bam,tophat_output/accepted_hits1b.bam tophat_output/accepted_hits2.bam
